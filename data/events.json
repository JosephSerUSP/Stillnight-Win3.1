[
  {
    "id": "stairs",
    "type": "stairs",
    "symbol": "S",
    "cssClass": "tile-stairs",
    "trigger": "step",
    "scripts": {
        "onEnter": [ { "type": "DESCEND" } ]
    }
  },
  {
    "id": "recovery",
    "type": "recovery",
    "symbol": "R",
    "cssClass": "tile-recovery",
    "trigger": "step",
    "scripts": {
        "onEnter": [
            { "type": "HEAL_PARTY", "message": "The soothing light restores your party." },
            { "type": "PLAY_SOUND", "name": "HEAL" },
            { "type": "LOG", "text": "You feel refreshed." }
        ]
    }
  },
  {
    "id": "enemy",
    "type": "enemy",
    "symbol": "E",
    "cssClass": "tile-enemy",
    "trigger": "touch",
    "scripts": {
        "onEnter": [{ "type": "BATTLE" }]
    }
  },
  {
    "id": "shrine",
    "type": "shrine",
    "symbol": "♱",
    "cssClass": "tile-shrine",
    "trigger": "touch",
    "scripts": {
        "onEnter": [
            { "type": "RANDOM_EVENT", "category": "shrine_scenario" }
        ]
    }
  },
  {
    "id": "shop",
    "type": "shop",
    "symbol": "¥",
    "cssClass": "tile-shop",
    "trigger": "touch",
    "scripts": {
        "onEnter": [{ "type": "SHOP" }]
    }
  },
  {
    "id": "recruit",
    "type": "recruit",
    "symbol": "U",
    "cssClass": "tile-recruit",
    "trigger": "touch",
    "scripts": {
        "onEnter": [{ "type": "RECRUIT" }]
    }
  },
  {
    "id": "npc",
    "type": "npc",
    "symbol": "N",
    "cssClass": "tile-npc",
    "trigger": "touch",
    "scripts": {
        "onEnter": [{ "type": "NPC_DIALOGUE" }]
    }
  },
  {
    "id": "npc_alicia",
    "type": "npc",
    "symbol": "A",
    "cssClass": "tile-npc-alicia",
    "trigger": "touch",
    "scripts": {
        "onEnter": [{ "type": "NPC_DIALOGUE", "id": "npc_alicia" }]
    }
  },
  {
    "id": "npc_laura",
    "type": "npc",
    "symbol": "L",
    "cssClass": "tile-npc-laura",
    "trigger": "touch",
    "scripts": {
        "onEnter": [{ "type": "NPC_DIALOGUE", "id": "npc_laura" }]
    }
  },
  {
    "id": "intro_cutscene",
    "type": "cutscene",
    "trigger": "autorun",
    "scripts": {
        "onStart": [
            {
                "type": "TEXT",
                "layout": "visual_novel",
                "title": "Town of Stillnight",
                "text": "The fog parts, revealing the settlement clinging to the edge of the void. Torches flicker against the encroaching dark.",
                "speakers": [],
                "style": "terminal"
            },
            {
                "type": "TEXT",
                "layout": "visual_novel",
                "title": "Alicia",
                "text": "Halt! Who goes there? State your business.",
                "speakers": [
                    { "id": "NPC_Alicia", "active": true, "emotion": "neutral" }
                ],
                "style": "terminal"
            },
            {
                "type": "TEXT",
                "layout": "visual_novel",
                "title": "Laura",
                "text": "Relax, Alicia. He looks harmless enough. A bit lost, perhaps?",
                "speakers": [
                    { "id": "NPC_Alicia", "active": false },
                    { "id": "NPC_Laura", "active": true, "emotion": "laughter" }
                ],
                "style": "terminal"
            },
            {
                "type": "TEXT",
                "layout": "visual_novel",
                "title": "Alicia",
                "text": "We can't afford to be careless, Laura. The creatures are getting bolder.",
                "speakers": [
                    { "id": "NPC_Alicia", "active": true, "emotion": "disapproval" },
                    { "id": "NPC_Laura", "active": false }
                ],
                "style": "terminal"
            },
            {
                "type": "TEXT",
                "layout": "visual_novel",
                "title": "Laura",
                "text": "But look at him! He's clearly the new Commander we've been expecting.",
                "speakers": [
                    { "id": "NPC_Alicia", "active": false },
                    { "id": "NPC_Laura", "active": true, "emotion": "neutral" }
                ],
                "style": "terminal"
            },
            {
                "type": "TEXT",
                "layout": "visual_novel",
                "title": "Alicia",
                "text": "...You are the Commander? My apologies. I am Alicia, Captain of the Guard.",
                "speakers": [
                    { "id": "NPC_Alicia", "active": true, "emotion": "neutral" },
                    { "id": "NPC_Laura", "active": false }
                ],
                "style": "terminal"
            },
            {
                "type": "TEXT",
                "layout": "visual_novel",
                "title": "Laura",
                "text": "And I'm Laura. Welcome to Stillnight, Commander. Or what's left of it.",
                "speakers": [
                    { "id": "NPC_Alicia", "active": false },
                    { "id": "NPC_Laura", "active": true, "emotion": "neutral" }
                ],
                "style": "terminal"
            },
            {
                "type": "TEXT",
                "layout": "visual_novel",
                "title": "Alicia",
                "text": "We have secured the town, but the dungeon below... it is a nightmare. We need your guidance.",
                "speakers": [
                    { "id": "NPC_Alicia", "active": true, "emotion": "neutral" },
                    { "id": "NPC_Laura", "active": false }
                ],
                "style": "terminal"
            },
            {
                "type": "TEXT",
                "layout": "visual_novel",
                "title": "Town of Stillnight",
                "text": "The gates creak open. Your journey into the depths begins now.",
                "speakers": [],
                "style": "terminal"
            }
        ]
    }
  },
  {
    "id": "npc_weapon_shop",
    "type": "npc",
    "symbol": "W",
    "cssClass": "tile-npc-weapon",
    "trigger": "touch",
    "scripts": {
        "onEnter": [{ "type": "NPC_DIALOGUE", "id": "npc_weapon_shop" }]
    }
  },
  {
    "id": "npc_auction",
    "type": "npc",
    "symbol": "$",
    "cssClass": "tile-npc-auction",
    "trigger": "touch",
    "scripts": {
        "onEnter": [{ "type": "NPC_DIALOGUE", "id": "npc_auction" }]
    }
  },
  {
    "id": "npc_daphne",
    "type": "npc",
    "symbol": "D",
    "cssClass": "tile-npc-daphne",
    "trigger": "touch",
    "scripts": {
        "onEnter": [{ "type": "NPC_DIALOGUE", "id": "npc_daphne" }]
    }
  },
  {
    "id": "npc_gate_guard",
    "type": "npc",
    "symbol": "G",
    "cssClass": "tile-npc-guard",
    "trigger": "touch",
    "scripts": {
        "onEnter": [{ "type": "NPC_DIALOGUE", "id": "npc_gate_guard" }]
    }
  },
  {
    "id": "trap",
    "type": "trap",
    "symbol": "T",
    "cssClass": "tile-trap",
    "trigger": "step",
    "hidden": true,
    "trapValue": 5,
    "scripts": {
        "onEnter": [
            { "type": "DAMAGE_PARTY", "amount": 5, "message": "You triggered a spike trap!" },
            { "type": "PLAY_SOUND", "name": "DAMAGE" }
        ]
    }
  },
  {
    "id": "treasure",
    "type": "treasure",
    "symbol": "$",
    "cssClass": "tile-treasure",
    "trigger": "touch",
    "scripts": {
        "onEnter": [
             { "type": "GIVE_ITEM", "itemType": "random" }
        ]
    }
  },
  {
    "id": "shrine_shade",
    "type": "shrine_scenario",
    "script": [
        { "type": "TEXT", "title": "Whispering Shade", "text": "A whisper from beyond promises knowledge... at a price.", "style": "terminal" },
        { "type": "CHOICE", "options": [
            {
                "label": "Offer HP (lose 3 HP each, gain XP)",
                "script": [
                    { "type": "DAMAGE_PARTY", "amount": 3 },
                    { "type": "GIVE_XP", "amount": 4 }
                ]
            },
            {
                "label": "Decline",
                "script": [
                    { "type": "LOG", "text": "[Shrine] You ignore the whispers." }
                ]
            }
        ]}
    ]
  },
  {
    "id": "shrine_idol",
    "type": "shrine_scenario",
    "script": [
        { "type": "TEXT", "title": "Gleaming Idol", "text": "A gleaming idol stands before you, radiating warmth. Touching it could imbue power or curse you.", "style": "terminal" },
        { "type": "CHOICE", "options": [
            {
                "label": "Touch the idol",
                "script": [
                     { "type": "WEIGHTED_BRANCH", "outcomes": [
                         { "chance": 0.5, "script": [ { "type": "LOG", "text": "MaxHP +2 (Simulated)" } ] },
                         { "chance": 0.5, "script": [ { "type": "DAMAGE_PARTY", "amount": 2 } ] }
                     ]}
                ]
            },
            {
                "label": "Walk away",
                "script": [
                    { "type": "LOG", "text": "[Shrine] You leave the idol untouched." }
                ]
            }
        ]}
    ]
  },
  {
    "id": "shrine_spirit",
    "type": "shrine_scenario",
    "script": [
        { "type": "TEXT", "title": "Bargaining Spirit", "text": "A translucent merchant appears, offering to trade gold for knowledge.", "style": "terminal" },
        { "type": "CHOICE", "options": [
            {
                "label": "Pay 5G for knowledge",
                "script": [
                    { "type": "TAKE_GOLD", "value": 5 },
                    { "type": "GIVE_XP", "amount": 6 }
                ]
            },
            {
                "label": "Attempt to bargain",
                "script": [
                    { "type": "WEIGHTED_BRANCH", "outcomes": [
                        { "chance": 0.5, "script": [ { "type": "GIVE_XP", "amount": 4 } ] },
                        { "chance": 0.5, "script": [ { "type": "TAKE_GOLD", "value": 2 } ] }
                    ]}
                ]
            },
            {
                "label": "Leave",
                "script": [
                    { "type": "LOG", "text": "[Shrine] You refuse the deal." }
                ]
            }
        ]}
    ]
  },
  {
    "id": "shrine_haste",
    "type": "shrine_scenario",
    "script": [
        { "type": "TEXT", "title": "Trial of Haste", "text": "A spectral stopwatch hovers in the air, its ticking echoing in your mind. It offers a challenge: a trial of speed for a reward.", "style": "terminal" },
        { "type": "CHOICE", "options": [
            {
                "label": "Accept the trial (high risk, high reward)",
                "script": [
                    { "type": "WEIGHTED_BRANCH", "outcomes": [
                        { "chance": 0.4, "script": [ { "type": "GIVE_XP", "amount": 15 } ] },
                        { "chance": 0.6, "script": [ { "type": "DAMAGE_PARTY", "amount": 5 } ] }
                    ]}
                ]
            },
            {
                "label": "Take a small reward instead",
                "script": [
                    { "type": "GIVE_GOLD", "value": 10 }
                ]
            }
        ]}
    ]
  }
]
