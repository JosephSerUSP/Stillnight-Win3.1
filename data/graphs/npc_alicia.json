{
  "id": "npc_alicia",
  "name": "Alicia",
  "layout": "visual_novel",
  "portrait": "NPC_Alicia",
  "initialNode": "root_router",
  "nodes": {
    "root_router": {
      "type": "ROUTER",
      "branches": [
         { "condition": "questStatus:silent_shipment:active", "target": "quest_shipment_router" },
         { "condition": "flag:alicia_first_met", "target": "default_hub_text" }
      ],
      "next": "intro_text"
    },

    "quest_shipment_router": {
      "type": "ROUTER",
      "condition": "flag:shipment_investigated",
      "trueNode": "default_hub_text",
      "falseNode": "quest_shipment_text"
    },

    "quest_shipment_text": {
      "type": "TEXT",
      "speaker": "Alicia",
      "content": "Oh! Are you looking for the supply cart? I heard it! I was listening to the wind near the chasm, and I heard squeaky wheels stop suddenly. Then... goblin noises. Lots of them.",
      "next": "quest_shipment_choices"
    },
    "quest_shipment_choices": {
      "type": "CHOICE",
      "options": [
        { "label": "Goblins? I should tell the guard.", "target": "quest_shipment_resolve", "setFlag": "shipment_investigated" }
      ]
    },
    "quest_shipment_resolve": {
      "type": "TEXT",
      "speaker": "Alicia",
      "content": "Please be careful! If the goblins have the food, they'll be... energetic.",
      "next": "default_hub_text"
    },

    "intro_text": {
      "type": "TEXT",
      "speaker": "Alicia",
      "content": "Oh! H-hello—! I… I didn’t see you coming. I’m Alicia. Welcome to my shop! Uhm— please look around! And— and if you’re hungry, I can warm something up. Not for sale. Just… because.",
      "next": "intro_choices"
    },
    "intro_choices": {
      "type": "CHOICE",
      "options": [
        { "label": "Buy Consumables", "target": "shop_consumables", "setFlag": "alicia_first_met" },
        { "label": "You’re kind.", "target": "intro_kind_text" },
        { "label": "Leave", "action": "close", "setFlag": "alicia_first_met" }
      ]
    },
    "intro_kind_text": {
      "type": "TEXT",
      "speaker": "Alicia",
      "content": "M-me? No, I’m… I’m normal. I just… I don’t like when people look empty. Like they forgot they have a body. Sorry. That sounded weird.",
      "next": "intro_kind_choices"
    },
    "intro_kind_choices": {
      "type": "CHOICE",
      "options": [
        { "label": "Not weird.", "target": "intro_not_weird_text" },
        { "label": "Buy Consumables", "target": "shop_consumables", "setFlag": "alicia_first_met" },
        { "label": "Leave", "action": "close", "setFlag": "alicia_first_met" }
      ]
    },
    "intro_not_weird_text": {
      "type": "TEXT",
      "speaker": "Alicia",
      "content": "…Thank you. People usually laugh. Or they say ‘that’s cute’ and then they don’t mean it. Anyway! Please— uhm— browse!",
      "next": "intro_not_weird_choices"
    },
    "intro_not_weird_choices": {
      "type": "CHOICE",
      "options": [
        { "label": "Buy Consumables", "target": "shop_consumables", "setFlag": "alicia_first_met" },
        { "label": "Talk", "target": "talk_menu_text", "setFlag": "alicia_first_met" },
        { "label": "Leave", "action": "close", "setFlag": "alicia_first_met" }
      ]
    },
    "default_hub_text": {
      "type": "TEXT",
      "speaker": "Alicia",
      "content": "Oh! H-hello there! I… I didn’t see you coming! Uhm… welcome! Please look around. And— uh— drink water. People forget.",
      "next": "default_hub_choices"
    },
    "default_hub_choices": {
      "type": "CHOICE",
      "options": [
        { "label": "Buy Consumables", "target": "shop_consumables" },
        { "label": "Talk", "target": "talk_menu_text" },
        { "label": "Leave", "action": "close" }
      ]
    },
    "shop_consumables": {
      "type": "ACTION",
      "action": "OPEN_SHOP",
      "shopId": "consumables_basic",
      "next": "default_hub_choices"
    },
    "talk_menu_text": {
      "type": "TEXT",
      "speaker": "Alicia",
      "content": "O-okay. What do you want to talk about? I’m not good at… normal conversations.",
      "next": "talk_menu_choices"
    },
    "talk_menu_choices": {
      "type": "CHOICE",
      "options": [
        { "label": "About Laura", "target": "talk_laura" },
        { "label": "About Shop", "target": "talk_shop" },
        { "label": "About You", "target": "talk_self" },
        { "label": "Quests", "target": "quest_hub_router" },
        { "label": "Back", "target": "default_hub_text" }
      ]
    },
    "talk_laura": {
      "type": "TEXT",
      "speaker": "Alicia",
      "content": "Laura? She’s… she’s amazing. She’s strong, and beautiful, and… and she smells like vanilla and iron. Is that weird? That’s weird. Forget I said that.",
      "next": "talk_menu_choices"
    },
    "talk_shop": {
      "type": "TEXT",
      "speaker": "Alicia",
      "content": "I sell things that keep you alive! It makes me happy. Watching people leave with full bags… it means they might come back. That’s nice.",
      "next": "talk_menu_choices"
    },
    "talk_self": {
      "type": "TEXT",
      "speaker": "Alicia",
      "content": "Me? I’m just Alicia. I like baking. And… I like listening to the rain. The dungeon is scary, but the rain makes it sound like it’s sleeping.",
      "next": "talk_menu_choices"
    },

    "quest_hub_router": {
      "type": "ROUTER",
      "branches": [
        { "condition": "questStatus:sparkling_gift:active", "target": "q1_active" },
        { "condition": "questStatus:sparkling_gift:inactive", "target": "q1_offer" },
        { "condition": "questStatus:cartographers_plea:active", "target": "q_cart_active" },
        { "condition": "questStatus:cartographers_plea:inactive", "target": "q_cart_offer" },
        { "condition": "questStatus:floral_study:active", "target": "q_floral_active" },
        { "condition": "questStatus:floral_study:inactive", "target": "q_floral_offer" },
        { "condition": "questStatus:cold_comfort:active", "target": "q_cold_active" },
        { "condition": "questStatus:cold_comfort:inactive", "target": "q_cold_offer" },
        { "condition": "questStatus:tick_tock:active", "target": "q_tick_active" },
        { "condition": "questStatus:tick_tock:inactive", "target": "q_tick_offer" },
        { "condition": "questStatus:edge_of_reason:active", "target": "q_void_active" },
        { "condition": "questStatus:edge_of_reason:inactive", "target": "q_void_offer" }
      ],
      "next": "no_more_quests_text"
    },

    "no_more_quests_text": {
        "type": "TEXT",
        "speaker": "Alicia",
        "content": "I... I don't have any other favors right now. But thank you for everything!",
        "next": "talk_menu_choices"
    },

    "q1_offer": {
      "type": "TEXT",
      "speaker": "Alicia",
      "content": "Actually… can I ask a favor? It’s about Laura. I want to give her something special. Something that… shines like she does. There’s a crystal, a ‘Glittering Teardrop’, deep in the dungeon. Would you…?",
      "next": "q1_offer_choices"
    },
    "q1_offer_choices": {
      "type": "CHOICE",
      "options": [
        { "label": "I'll find it.", "target": "q1_action" },
        { "label": "Maybe later.", "target": "talk_menu_text" }
      ]
    },
    "q1_action": { "type": "ACTION", "action": "OFFER_QUEST", "questId": "sparkling_gift", "next": "talk_menu_text" },
    "q1_active": {
         "type": "ROUTER",
         "condition": "hasItem:glittering_teardrop",
         "trueNode": "q1_turnin",
         "falseNode": "q1_waiting"
    },
    "q1_waiting": {
        "type": "TEXT",
        "speaker": "Alicia",
        "content": "Be careful looking for the teardrop. It's slippery down there.",
        "next": "talk_menu_choices"
    },
    "q1_turnin": {
        "type": "TEXT",
        "speaker": "Alicia",
        "content": "You found it! Oh, it's beautiful. Thank you so much!",
        "next": "q1_complete"
    },
    "q1_complete": { "type": "ACTION", "action": "COMPLETE_QUEST", "questId": "sparkling_gift", "next": "talk_menu_text" },


    "q_cart_offer": {
        "type": "TEXT",
        "speaker": "Alicia",
        "content": "The Guild needs help. The maps for the Rusted Choir, the third floor... they're old. Can you go there and just... check the paths? Just reaching the floor is enough.",
        "next": "q_cart_offer_choices"
    },
    "q_cart_offer_choices": {
        "type": "CHOICE",
        "options": [{ "label": "Accept", "target": "q_cart_action" }, { "label": "Decline", "target": "talk_menu_text" }]
    },
    "q_cart_action": { "type": "ACTION", "action": "OFFER_QUEST", "questId": "cartographers_plea", "next": "talk_menu_text" },
    "q_cart_active": {
        "type": "ROUTER",
        "condition": "flag:visited_floor_3",
        "trueNode": "q_cart_turnin",
        "falseNode": "q_cart_waiting"
    },
    "q_cart_waiting": {
        "type": "TEXT",
        "speaker": "Alicia",
        "content": "Have you reached the third floor yet? Please be careful of the bells.",
        "next": "talk_menu_choices"
    },
    "q_cart_turnin": {
        "type": "TEXT",
        "speaker": "Alicia",
        "content": "You made it back! The Guild will be so relieved. Here is the payment for the data.",
        "next": "q_cart_complete"
    },
    "q_cart_complete": { "type": "ACTION", "action": "COMPLETE_QUEST", "questId": "cartographers_plea", "next": "talk_menu_text" },

    "q_floral_offer": {
        "type": "TEXT",
        "speaker": "Alicia",
        "content": "Uhm, I read about a flower. A 'Rare Flower' that only grows in the Overgrown Forest. It's supposed to smell like memories. Could you... maybe find one?",
        "next": "q_floral_offer_choices"
    },
    "q_floral_offer_choices": {
        "type": "CHOICE",
        "options": [{ "label": "Accept", "target": "q_floral_action" }, { "label": "Decline", "target": "talk_menu_text" }]
    },
    "q_floral_action": { "type": "ACTION", "action": "OFFER_QUEST", "questId": "floral_study", "next": "talk_menu_text" },
    "q_floral_active": {
        "type": "ROUTER",
        "condition": "hasItem:rare_flower",
        "trueNode": "q_floral_turnin",
        "falseNode": "q_floral_waiting"
    },
    "q_floral_waiting": {
        "type": "TEXT",
        "speaker": "Alicia",
        "content": "The forest is dangerous. Don't worry about the flower if it's too hard.",
        "next": "talk_menu_choices"
    },
    "q_floral_turnin": {
        "type": "TEXT",
        "speaker": "Alicia",
        "content": "Oh! It's real! It smells like... like my grandmother's kitchen. Thank you. This means a lot.",
        "next": "q_floral_complete"
    },
    "q_floral_complete": { "type": "ACTION", "action": "COMPLETE_QUEST", "questId": "floral_study", "next": "talk_menu_text" },

    "q_cold_offer": {
        "type": "TEXT",
        "speaker": "Alicia",
        "content": "It's getting so hot lately. The Sunken Caverns have creatures made of ice... Sahagins carry Ice Shards. Could you bring some back to cool the shop?",
        "next": "q_cold_offer_choices"
    },
    "q_cold_offer_choices": {
        "type": "CHOICE",
        "options": [{ "label": "Accept", "target": "q_cold_action" }, { "label": "Decline", "target": "talk_menu_text" }]
    },
    "q_cold_action": { "type": "ACTION", "action": "OFFER_QUEST", "questId": "cold_comfort", "next": "talk_menu_text" },
    "q_cold_active": {
        "type": "ROUTER",
        "condition": "requirementsMet:cold_comfort",
        "trueNode": "q_cold_turnin",
        "falseNode": "q_cold_waiting"
    },
    "q_cold_waiting": {
        "type": "TEXT",
        "speaker": "Alicia",
        "content": "Stay warm... or cool? Just stay safe in the caverns.",
        "next": "talk_menu_choices"
    },
    "q_cold_turnin": {
        "type": "TEXT",
        "speaker": "Alicia",
        "content": "Perfect! I'll put these in the cellar. Here, take some potions for your trouble.",
        "next": "q_cold_complete"
    },
    "q_cold_complete": { "type": "ACTION", "action": "COMPLETE_QUEST", "questId": "cold_comfort", "next": "talk_menu_text" },

    "q_tick_offer": {
        "type": "TEXT",
        "speaker": "Alicia",
        "content": "I found this music box, but it's missing a gear. The automatons in the Spire use similar parts. Could you find a pristine Clock Gear?",
        "next": "q_tick_offer_choices"
    },
    "q_tick_offer_choices": {
        "type": "CHOICE",
        "options": [{ "label": "Accept", "target": "q_tick_action" }, { "label": "Decline", "target": "talk_menu_text" }]
    },
    "q_tick_action": { "type": "ACTION", "action": "OFFER_QUEST", "questId": "tick_tock", "next": "talk_menu_text" },
    "q_tick_active": {
        "type": "ROUTER",
        "condition": "hasItem:clock_gear",
        "trueNode": "q_tick_turnin",
        "falseNode": "q_tick_waiting"
    },
    "q_tick_waiting": {
        "type": "TEXT",
        "speaker": "Alicia",
        "content": "The ticking in that spire is unnerving. Don't let it get to you.",
        "next": "talk_menu_choices"
    },
    "q_tick_turnin": {
        "type": "TEXT",
        "speaker": "Alicia",
        "content": "It fits! Listen... *musical notes play*. It's beautiful. Thank you.",
        "next": "q_tick_complete"
    },
    "q_tick_complete": { "type": "ACTION", "action": "COMPLETE_QUEST", "questId": "tick_tock", "next": "talk_menu_text" },

    "q_void_offer": {
        "type": "TEXT",
        "speaker": "Alicia",
        "content": "The scholars are asking for something dangerous. 'Void Dust'. From the edge of reality. They say it's for science, but... be careful.",
        "next": "q_void_offer_choices"
    },
    "q_void_offer_choices": {
        "type": "CHOICE",
        "options": [{ "label": "Accept", "target": "q_void_action" }, { "label": "Decline", "target": "talk_menu_text" }]
    },
    "q_void_action": { "type": "ACTION", "action": "OFFER_QUEST", "questId": "edge_of_reason", "next": "talk_menu_text" },
    "q_void_active": {
        "type": "ROUTER",
        "condition": "requirementsMet:edge_of_reason",
        "trueNode": "q_void_turnin",
        "falseNode": "q_void_waiting"
    },
    "q_void_waiting": {
        "type": "TEXT",
        "speaker": "Alicia",
        "content": "The Void... it feels like it's watching us. Hurry back.",
        "next": "talk_menu_choices"
    },
    "q_void_turnin": {
        "type": "TEXT",
        "speaker": "Alicia",
        "content": "You got it? It's... cold. And heavy. I'll send it to the scholars immediately. Here are some boots they sent for you.",
        "next": "q_void_complete"
    },
    "q_void_complete": { "type": "ACTION", "action": "COMPLETE_QUEST", "questId": "edge_of_reason", "next": "talk_menu_text" }
  }
}
