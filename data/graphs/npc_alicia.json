{
  "id": "npc_alicia",
  "name": "Alicia",
  "layout": "visual_novel",
  "portrait": "NPC_Alicia",
  "initialNode": "root_router",
  "nodes": {
    "root_router": {
      "type": "ROUTER",
      "branches": [
         { "condition": "questStatus:silent_shipment:active", "target": "quest_shipment_router" },
         { "condition": "flag:alicia_first_met", "target": "default_hub_text" }
      ],
      "next": "intro_text"
    },

    "quest_shipment_router": {
      "type": "ROUTER",
      "condition": "flag:shipment_investigated",
      "trueNode": "default_hub_text",
      "falseNode": "quest_shipment_text"
    },

    "quest_shipment_text": {
      "type": "TEXT",
      "speaker": "Alicia",
      "content": "Oh! Are you looking for the supply cart? I heard it! I was listening to the wind near the chasm, and I heard squeaky wheels stop suddenly. Then... goblin noises. Lots of them.",
      "next": "quest_shipment_choices"
    },
    "quest_shipment_choices": {
      "type": "CHOICE",
      "options": [
        { "label": "Goblins? I should tell the guard.", "target": "quest_shipment_resolve", "setFlag": "shipment_investigated" }
      ]
    },
    "quest_shipment_resolve": {
      "type": "TEXT",
      "speaker": "Alicia",
      "content": "Please be careful! If the goblins have the food, they'll be... energetic.",
      "next": "default_hub_text"
    },

    "intro_text": {
      "type": "TEXT",
      "speaker": "Alicia",
      "content": "Oh! H-hello—! I… I didn’t see you coming. I’m Alicia. Welcome to my shop! Uhm— please look around! And— and if you’re hungry, I can warm something up. Not for sale. Just… because.",
      "next": "intro_choices"
    },
    "intro_choices": {
      "type": "CHOICE",
      "options": [
        { "label": "Buy Consumables", "target": "shop_consumables", "setFlag": "alicia_first_met" },
        { "label": "You’re kind.", "target": "intro_kind_text" },
        { "label": "Leave", "action": "close", "setFlag": "alicia_first_met" }
      ]
    },
    "intro_kind_text": {
      "type": "TEXT",
      "speaker": "Alicia",
      "content": "M-me? No, I’m… I’m normal. I just… I don’t like when people look empty. Like they forgot they have a body. Sorry. That sounded weird.",
      "next": "intro_kind_choices"
    },
    "intro_kind_choices": {
      "type": "CHOICE",
      "options": [
        { "label": "Not weird.", "target": "intro_not_weird_text" },
        { "label": "Buy Consumables", "target": "shop_consumables", "setFlag": "alicia_first_met" },
        { "label": "Leave", "action": "close", "setFlag": "alicia_first_met" }
      ]
    },
    "intro_not_weird_text": {
      "type": "TEXT",
      "speaker": "Alicia",
      "content": "…Thank you. People usually laugh. Or they say ‘that’s cute’ and then they don’t mean it. Anyway! Please— uhm— browse!",
      "next": "intro_not_weird_choices"
    },
    "intro_not_weird_choices": {
      "type": "CHOICE",
      "options": [
        { "label": "Buy Consumables", "target": "shop_consumables", "setFlag": "alicia_first_met" },
        { "label": "Talk", "target": "talk_menu_text", "setFlag": "alicia_first_met" },
        { "label": "Leave", "action": "close", "setFlag": "alicia_first_met" }
      ]
    },
    "default_hub_text": {
      "type": "TEXT",
      "speaker": "Alicia",
      "content": "Oh! H-hello there! I… I didn’t see you coming! Uhm… welcome! Please look around. And— uh— drink water. People forget.",
      "next": "default_hub_choices"
    },
    "default_hub_choices": {
      "type": "CHOICE",
      "options": [
        { "label": "Buy Consumables", "target": "shop_consumables" },
        { "label": "Talk", "target": "talk_menu_text" },
        { "label": "Leave", "action": "close" }
      ]
    },
    "shop_consumables": {
      "type": "ACTION",
      "action": "OPEN_SHOP",
      "shopId": "consumables_basic",
      "next": "default_hub_choices"
    },
    "talk_menu_text": {
      "type": "TEXT",
      "speaker": "Alicia",
      "content": "O-okay. What do you want to talk about? I’m not good at… normal conversations.",
      "next": "talk_menu_choices"
    },
    "talk_menu_choices": {
      "type": "CHOICE",
      "options": [
        { "label": "About Laura", "target": "talk_laura" },
        { "label": "About Shop", "target": "talk_shop" },
        { "label": "About You", "target": "talk_self" },
        { "label": "Ask about Quest", "target": "quest_router" },
        { "label": "Crystal Light (Quest)", "target": "quest_crystal_router" },
        { "label": "Mana Gathering (Quest)", "target": "quest_mana_router" },
        { "label": "Back", "target": "default_hub_text" }
      ]
    },
    "talk_laura": {
      "type": "TEXT",
      "speaker": "Alicia",
      "content": "Laura? She’s… she’s amazing. She’s strong, and beautiful, and… and she smells like vanilla and iron. Is that weird? That’s weird. Forget I said that.",
      "next": "talk_menu_choices"
    },
    "talk_shop": {
      "type": "TEXT",
      "speaker": "Alicia",
      "content": "I sell things that keep you alive! It makes me happy. Watching people leave with full bags… it means they might come back. That’s nice.",
      "next": "talk_menu_choices"
    },
    "talk_self": {
      "type": "TEXT",
      "speaker": "Alicia",
      "content": "Me? I’m just Alicia. I like baking. And… I like listening to the rain. The dungeon is scary, but the rain makes it sound like it’s sleeping.",
      "next": "talk_menu_choices"
    },
    "quest_router": {
      "type": "ROUTER",
      "branches": [
        { "condition": "questStatus:sparkling_gift:completed", "target": "quest_completed_text" },
        { "condition": "questStatus:sparkling_gift:active", "target": "quest_active_text" }
      ],
      "next": "quest_offer_text"
    },
    "quest_offer_text": {
      "type": "TEXT",
      "speaker": "Alicia",
      "content": "Actually… can I ask a favor? It’s about Laura. I want to give her something special. Something that… shines like she does. There’s a crystal, a ‘Glittering Teardrop’, deep in the dungeon. Would you…?",
      "next": "quest_offer_choices"
    },
    "quest_offer_choices": {
      "type": "CHOICE",
      "options": [
        { "label": "I'll find it.", "target": "action_offer_quest" },
        { "label": "Maybe later.", "target": "talk_menu_text" }
      ]
    },
    "action_offer_quest": {
      "type": "ACTION",
      "action": "OFFER_QUEST",
      "questId": "sparkling_gift",
      "acceptNode": "quest_active_text",
      "declineNode": "talk_menu_text"
    },
    "quest_active_text": {
      "type": "TEXT",
      "speaker": "Alicia",
      "content": "The Glittering Teardrop… please be careful. It’s pretty, but the dungeon is mean. Don’t get hurt for a rock, okay?",
      "next": "quest_active_router"
    },
    "quest_active_router": {
      "type": "ROUTER",
      "condition": "hasItem:glittering_teardrop",
      "trueNode": "quest_turnin_text",
      "falseNode": "quest_active_choices"
    },
    "quest_active_choices": {
      "type": "CHOICE",
      "options": [
        { "label": "I'm still looking.", "target": "talk_menu_text" }
      ]
    },
    "quest_turnin_text": {
      "type": "TEXT",
      "speaker": "Alicia",
      "content": "You… you found it! Oh, look at it! It’s perfect. It catches the light just like her eyes when she’s happy. Thank you! Thank you so much!",
      "next": "quest_turnin_choices"
    },
    "quest_turnin_choices": {
      "type": "CHOICE",
      "options": [
        { "label": "Here you go.", "target": "action_complete_quest" }
      ]
    },
    "action_complete_quest": {
      "type": "ACTION",
      "action": "COMPLETE_QUEST",
      "questId": "sparkling_gift",
      "completeNode": "quest_completed_text",
      "takeItem": "glittering_teardrop"
    },
    "quest_completed_text": {
      "type": "TEXT",
      "speaker": "Alicia",
      "content": "I’m going to make this into a necklace. Or maybe a ring? No, a necklace. She doesn’t like rings when she works. Thank you again!",
      "next": "talk_menu_choices"
    },

    "quest_crystal_router": {
      "type": "ROUTER",
      "branches": [
        { "condition": "questStatus:crystal_light:completed", "target": "quest_crystal_done" },
        { "condition": "questStatus:crystal_light:active", "target": "quest_crystal_active" }
      ],
      "next": "quest_crystal_offer"
    },
    "quest_crystal_offer": {
      "type": "TEXT",
      "content": "The lamp... it's fading. It keeps the shadows away. I need a Crystal Core to reignite it. Please?",
      "next": "quest_crystal_choice"
    },
    "quest_crystal_choice": {
      "type": "CHOICE",
      "options": [
        { "label": "I'll find a Core.", "target": "action_offer_crystal" },
        { "label": "Not now.", "target": "talk_menu_text" }
      ]
    },
    "action_offer_crystal": {
      "type": "ACTION",
      "action": "OFFER_QUEST",
      "questId": "crystal_light",
      "acceptNode": "quest_crystal_active",
      "declineNode": "talk_menu_text"
    },
    "quest_crystal_active": {
      "type": "ROUTER",
      "condition": "hasItem:crystal_core",
      "trueNode": "quest_crystal_turnin",
      "falseNode": "talk_menu_text"
    },
    "quest_crystal_turnin": {
      "type": "TEXT",
      "content": "You found it! The light... it's so warm.",
      "next": "action_complete_crystal"
    },
    "action_complete_crystal": {
      "type": "ACTION",
      "action": "COMPLETE_QUEST",
      "questId": "crystal_light",
      "completeNode": "quest_crystal_done",
      "takeItem": "crystal_core"
    },
    "quest_crystal_done": {
      "type": "TEXT",
      "content": "Thank you. Now the shop won't be so dark.",
      "next": "talk_menu_text"
    },

    "quest_mana_router": {
      "type": "ROUTER",
      "branches": [
        { "condition": "questStatus:mana_gathering:completed", "target": "quest_mana_done" },
        { "condition": "questStatus:mana_gathering:active", "target": "quest_mana_active" }
      ],
      "next": "quest_mana_offer"
    },
    "quest_mana_offer": {
      "type": "TEXT",
      "content": "Magic is strange, isn't it? I want to study it. Can you bring me some Mana Motes from the wisps?",
      "next": "quest_mana_choice"
    },
    "quest_mana_choice": {
      "type": "CHOICE",
      "options": [
        { "label": "Sure.", "target": "action_offer_mana" },
        { "label": "Too busy.", "target": "talk_menu_text" }
      ]
    },
    "action_offer_mana": {
      "type": "ACTION",
      "action": "OFFER_QUEST",
      "questId": "mana_gathering",
      "acceptNode": "quest_mana_active",
      "declineNode": "talk_menu_text"
    },
    "quest_mana_active": {
      "type": "ROUTER",
      "condition": "hasItem:mana_mote:3",
      "trueNode": "quest_mana_turnin",
      "falseNode": "talk_menu_text"
    },
    "quest_mana_turnin": {
      "type": "TEXT",
      "content": "They tingle! It's like holding a tiny storm.",
      "next": "action_complete_mana"
    },
    "action_complete_mana": {
      "type": "ACTION",
      "action": "COMPLETE_QUEST",
      "questId": "mana_gathering",
      "completeNode": "quest_mana_done",
      "takeItem": "mana_mote:3"
    },
    "quest_mana_done": {
      "type": "TEXT",
      "content": "I'll put these in a jar. A very thick jar.",
      "next": "talk_menu_text"
    }
  }
}
