{
  "id": "npc_laura",
  "name": "Laura",
  "layout": "visual_novel",
  "portrait": "NPC_Laura",
  "initialNode": "root_router",
  "nodes": {
    "root_router": {
      "type": "ROUTER",
      "branches": [
        { "condition": "questStatus:golden_promise:completed", "target": "talk_menu_text" },
        { "condition": "questStatus:golden_promise:active", "target": "quest_active_router" },
        { "condition": "flag:laura_first_met", "target": "default_hub_text" }
      ],
      "next": "intro_text"
    },

    "intro_text": {
      "type": "TEXT",
      "speaker": "Laura",
      "content": "Don't touch the anvil. It's hot. I'm Laura. If you want steel that won't shatter when a goblin looks at it, you're in the right place.",
      "next": "intro_choices"
    },
    "intro_choices": {
      "type": "CHOICE",
      "options": [
        { "label": "Shop", "target": "shop_weapons", "setFlag": "laura_first_met" },
        { "label": "You look busy.", "target": "intro_busy_text" },
        { "label": "Leave", "action": "close", "setFlag": "laura_first_met" }
      ]
    },
    "intro_busy_text": {
      "type": "TEXT",
      "speaker": "Laura",
      "content": "Always. The dungeon chews up armor like candy. Someone has to put it back together.",
      "next": "intro_busy_choices"
    },
    "intro_busy_choices": {
      "type": "CHOICE",
      "options": [
        { "label": "Shop", "target": "shop_weapons", "setFlag": "laura_first_met" },
        { "label": "Leave", "action": "close", "setFlag": "laura_first_met" }
      ]
    },

    "default_hub_text": {
      "type": "TEXT",
      "speaker": "Laura",
      "content": "Back again? Did your sword break, or are you just looking for an upgrade?",
      "next": "default_hub_choices"
    },
    "default_hub_choices": {
      "type": "CHOICE",
      "options": [
        { "label": "Shop", "target": "shop_weapons" },
        { "label": "Talk", "target": "talk_menu_text" },
        { "label": "Leave", "action": "close" }
      ]
    },
    "shop_weapons": {
      "type": "ACTION",
      "action": "OPEN_SHOP",
      "shopId": "weapons_basic",
      "next": "default_hub_choices"
    },

    "talk_menu_text": {
      "type": "TEXT",
      "speaker": "Laura",
      "content": "Make it quick. The fire is dying down.",
      "next": "talk_menu_choices"
    },
    "talk_menu_choices": {
      "type": "CHOICE",
      "options": [
        { "label": "About Alicia", "target": "talk_alicia" },
        { "label": "About Crafting", "target": "talk_crafting" },
        { "label": "Quests", "target": "quest_hub_router" },
        { "label": "Back", "target": "default_hub_text" }
      ]
    },
    "talk_alicia": {
      "type": "TEXT",
      "speaker": "Laura",
      "content": "Alicia? She's... soft. But the world needs soft things. Otherwise, what are we protecting with all this steel?",
      "next": "talk_menu_choices"
    },
    "talk_crafting": {
      "type": "TEXT",
      "speaker": "Laura",
      "content": "It's not just hitting metal. It's knowing how the metal wants to bend. You fight monsters, I fight iron. We both bleed.",
      "next": "talk_menu_choices"
    },

    "quest_hub_router": {
      "type": "ROUTER",
      "branches": [
        { "condition": "questStatus:golden_promise:active", "target": "q1_active" },
        { "condition": "questStatus:golden_promise:inactive", "target": "q1_offer" },
        { "condition": "questStatus:bone_collector:active", "target": "q_bone_active" },
        { "condition": "questStatus:bone_collector:inactive", "target": "q_bone_offer" },
        { "condition": "questStatus:natures_wrath:active", "target": "q_nature_active" },
        { "condition": "questStatus:natures_wrath:inactive", "target": "q_nature_offer" },
        { "condition": "questStatus:the_glow_below:active", "target": "q_glow_active" },
        { "condition": "questStatus:the_glow_below:inactive", "target": "q_glow_offer" },
        { "condition": "questStatus:schematic_hunt:active", "target": "q_scheme_active" },
        { "condition": "questStatus:schematic_hunt:inactive", "target": "q_scheme_offer" }
      ],
      "next": "no_more_quests_text"
    },

    "no_more_quests_text": {
        "type": "TEXT",
        "speaker": "Laura",
        "content": "I've got enough work for now. Come back later.",
        "next": "talk_menu_choices"
    },

    "q1_offer": {
      "type": "TEXT",
      "speaker": "Laura",
      "content": "I need material that doesn't rust. There's a rumor of an 'Untarnished Signet' carried by the undead deep down. Get it for me, and I'll make it worth your while.",
      "next": "q1_offer_choices"
    },
    "q1_offer_choices": {
      "type": "CHOICE",
      "options": [
        { "label": "Accept", "target": "q1_action" },
        { "label": "Decline", "target": "talk_menu_text" }
      ]
    },
    "q1_action": { "type": "ACTION", "action": "OFFER_QUEST", "questId": "golden_promise", "next": "talk_menu_text" },
    "q1_active": {
         "type": "ROUTER",
         "condition": "hasItem:untarnished_signet",
         "trueNode": "q1_turnin",
         "falseNode": "q1_waiting"
    },
    "q1_waiting": {
        "type": "TEXT",
        "speaker": "Laura",
        "content": "Still haven't found the ring? Check the skeletons. They like shiny things.",
        "next": "talk_menu_choices"
    },
    "q1_turnin": {
        "type": "TEXT",
        "speaker": "Laura",
        "content": "This is it. Gold that never fades. Good work.",
        "next": "q1_complete"
    },
    "q1_complete": { "type": "ACTION", "action": "COMPLETE_QUEST", "questId": "golden_promise", "next": "talk_menu_text" },


    "q_bone_offer": {
        "type": "TEXT",
        "speaker": "Laura",
        "content": "I'm running low on flux. Bone meal works in a pinch. Bring me 3 Bone Plates from those rattling nuisances on the first few floors.",
        "next": "q_bone_offer_choices"
    },
    "q_bone_offer_choices": {
        "type": "CHOICE",
        "options": [{ "label": "Accept", "target": "q_bone_action" }, { "label": "Decline", "target": "talk_menu_text" }]
    },
    "q_bone_action": { "type": "ACTION", "action": "OFFER_QUEST", "questId": "bone_collector", "next": "talk_menu_text" },
    "q_bone_active": {
        "type": "ROUTER",
        "condition": "requirementsMet:bone_collector",
        "trueNode": "q_bone_turnin",
        "falseNode": "q_bone_waiting"
    },
    "q_bone_waiting": {
        "type": "TEXT",
        "speaker": "Laura",
        "content": "Just smash them and bring the pieces. It's not complicated.",
        "next": "talk_menu_choices"
    },
    "q_bone_turnin": {
        "type": "TEXT",
        "speaker": "Laura",
        "content": "These are brittle, but they'll do. Here's a blade I finished earlier.",
        "next": "q_bone_complete"
    },
    "q_bone_complete": { "type": "ACTION", "action": "COMPLETE_QUEST", "questId": "bone_collector", "next": "talk_menu_text" },

    "q_nature_offer": {
        "type": "TEXT",
        "speaker": "Laura",
        "content": "The forest floor is toxic. I want to make armor that resists it. I need Toxic Spores to test the finish. 2 should be enough.",
        "next": "q_nature_offer_choices"
    },
    "q_nature_offer_choices": {
        "type": "CHOICE",
        "options": [{ "label": "Accept", "target": "q_nature_action" }, { "label": "Decline", "target": "talk_menu_text" }]
    },
    "q_nature_action": { "type": "ACTION", "action": "OFFER_QUEST", "questId": "natures_wrath", "next": "talk_menu_text" },
    "q_nature_active": {
        "type": "ROUTER",
        "condition": "requirementsMet:natures_wrath",
        "trueNode": "q_nature_turnin",
        "falseNode": "q_nature_waiting"
    },
    "q_nature_waiting": {
        "type": "TEXT",
        "speaker": "Laura",
        "content": "Don't breathe the spores in. Just bag them.",
        "next": "talk_menu_choices"
    },
    "q_nature_turnin": {
        "type": "TEXT",
        "speaker": "Laura",
        "content": "Nasty stuff. Perfect. Take this cloak, it should help you breathe easier.",
        "next": "q_nature_complete"
    },
    "q_nature_complete": { "type": "ACTION", "action": "COMPLETE_QUEST", "questId": "natures_wrath", "next": "talk_menu_text" },

    "q_glow_offer": {
        "type": "TEXT",
        "speaker": "Laura",
        "content": "My lamps are dim. The Sunken Caverns have a 'Deep Moss' that glows underwater. Bring me a sample.",
        "next": "q_glow_offer_choices"
    },
    "q_glow_offer_choices": {
        "type": "CHOICE",
        "options": [{ "label": "Accept", "target": "q_glow_action" }, { "label": "Decline", "target": "talk_menu_text" }]
    },
    "q_glow_action": { "type": "ACTION", "action": "OFFER_QUEST", "questId": "the_glow_below", "next": "talk_menu_text" },
    "q_glow_active": {
        "type": "ROUTER",
        "condition": "hasItem:deep_moss",
        "trueNode": "q_glow_turnin",
        "falseNode": "q_glow_waiting"
    },
    "q_glow_waiting": {
        "type": "TEXT",
        "speaker": "Laura",
        "content": "It's dark in here. Hurry with that moss.",
        "next": "talk_menu_choices"
    },
    "q_glow_turnin": {
        "type": "TEXT",
        "speaker": "Laura",
        "content": "Bright. Very bright. This will light up the anvil nicely.",
        "next": "q_glow_complete"
    },
    "q_glow_complete": { "type": "ACTION", "action": "COMPLETE_QUEST", "questId": "the_glow_below", "next": "talk_menu_text" },

    "q_scheme_offer": {
        "type": "TEXT",
        "speaker": "Laura",
        "content": "Those clockwork things... they move too well. I need to know how. Find a 'Mechanism Blueprint' on a Knight. I want to see their joints.",
        "next": "q_scheme_offer_choices"
    },
    "q_scheme_offer_choices": {
        "type": "CHOICE",
        "options": [{ "label": "Accept", "target": "q_scheme_action" }, { "label": "Decline", "target": "talk_menu_text" }]
    },
    "q_scheme_action": { "type": "ACTION", "action": "OFFER_QUEST", "questId": "schematic_hunt", "next": "talk_menu_text" },
    "q_scheme_active": {
        "type": "ROUTER",
        "condition": "hasItem:mechanism_blueprint",
        "trueNode": "q_scheme_turnin",
        "falseNode": "q_scheme_waiting"
    },
    "q_scheme_waiting": {
        "type": "TEXT",
        "speaker": "Laura",
        "content": "I can hear the grinding from here. Find me that paper.",
        "next": "talk_menu_choices"
    },
    "q_scheme_turnin": {
        "type": "TEXT",
        "speaker": "Laura",
        "content": "Look at this... gears within gears. It's genius. And terrifying. Here, take this blade. It's sharp.",
        "next": "q_scheme_complete"
    },
    "q_scheme_complete": { "type": "ACTION", "action": "COMPLETE_QUEST", "questId": "schematic_hunt", "next": "talk_menu_text" }
  }
}
