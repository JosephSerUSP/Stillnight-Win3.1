{
  "id": "npc_laura",
  "name": "Laura",
  "layout": "visual_novel",
  "portrait": "NPC_Laura",
  "initialNode": "root_router",
  "nodes": {
    "root_router": {
      "type": "ROUTER",
      "branches": [
        { "condition": "questStatus:broken_blade:active", "target": "quest_blade_router" },
        { "condition": "flag:laura_met", "target": "default_hub_text" }
      ],
      "next": "intro_text"
    },

    "intro_text": {
      "type": "TEXT",
      "speaker": "Laura",
      "content": "Hmm? Oh. You're the new one. Eyes forward, don't drag your feet. The smithy is hot, and I don't have time for tourists.",
      "next": "intro_choices"
    },
    "intro_choices": {
      "type": "CHOICE",
      "options": [
        { "label": "I need weapons.", "target": "shop_weapons", "setFlag": "laura_met" },
        { "label": "You seem busy.", "target": "intro_busy_text" },
        { "label": "Leave", "action": "close", "setFlag": "laura_met" }
      ]
    },
    "intro_busy_text": {
      "type": "TEXT",
      "speaker": "Laura",
      "content": "Steel doesn't shape itself. If you're not buying or repairing, get out of the smoke.",
      "next": "intro_busy_choices"
    },
    "intro_busy_choices": {
      "type": "CHOICE",
      "options": [
        { "label": "Understood.", "target": "shop_weapons", "setFlag": "laura_met" },
        { "label": "Talk", "target": "talk_hub", "setFlag": "laura_met" },
        { "label": "Leave", "action": "close", "setFlag": "laura_met" }
      ]
    },

    "default_hub_text": {
      "type": "TEXT",
      "speaker": "Laura",
      "content": "Back again? Blade dull already? Or are you just looking for warmth?",
      "next": "default_hub_choices"
    },
    "default_hub_choices": {
      "type": "CHOICE",
      "options": [
        { "label": "Shop Weapons", "target": "shop_weapons" },
        { "label": "Talk", "target": "talk_hub" },
        { "label": "Leave", "action": "close" }
      ]
    },
    "shop_weapons": {
      "type": "ACTION",
      "action": "OPEN_SHOP",
      "shopId": "weapons_basic",
      "next": "default_hub_choices"
    },

    "talk_hub": {
      "type": "TEXT",
      "speaker": "Laura",
      "content": "(She wipes soot from her forehead, giving you a brief moment of attention.)",
      "next": "talk_menu_choices"
    },
    "talk_menu_choices": {
      "type": "CHOICE",
      "options": [
        { "label": "About Alicia", "target": "talk_alicia" },
        { "label": "About Smithing", "target": "talk_smithing" },
        { "label": "Ask about Quest", "target": "quest_router" },
        { "label": "That's all.", "target": "default_hub_choices" }
      ]
    },
    "talk_alicia": {
      "type": "TEXT",
      "speaker": "Laura",
      "content": "Alicia? She's... soft. Too soft for this place. But she makes good bread. And she doesn't ask stupid questions. I tolerate her.",
      "next": "talk_buffer_choices"
    },
    "talk_smithing": {
      "type": "TEXT",
      "speaker": "Laura",
      "content": "Fire purifies. Metal obeys. People... people lie. Steel never lies to you. It just is. That's why I like it.",
      "next": "talk_buffer_choices"
    },
    "talk_buffer_choices": {
      "type": "CHOICE",
      "options": [
        { "label": "Ask about something else.", "target": "talk_hub" },
        { "label": "I'm going.", "target": "default_hub_choices" }
      ]
    },

    "quest_router": {
      "type": "ROUTER",
      "branches": [
        { "condition": "questStatus:broken_blade:completed", "target": "quest_completed_text" },
        { "condition": "questStatus:broken_blade:active", "target": "quest_active_text" }
      ],
      "next": "quest_offer_text"
    },
    "quest_offer_text": {
      "type": "TEXT",
      "speaker": "Laura",
      "content": "You're going deep? There's a rumor. An ancient blade, shattered in the lower levels. 'Shattered Blade'. If you find the pieces... I might be able to reforge it. Interested?",
      "next": "quest_offer_choices"
    },
    "quest_offer_choices": {
      "type": "CHOICE",
      "options": [
        { "label": "I'll look for it.", "target": "action_offer_quest" },
        { "label": "Not my job.", "target": "talk_hub" }
      ]
    },
    "action_offer_quest": {
      "type": "ACTION",
      "action": "OFFER_QUEST",
      "questId": "broken_blade",
      "acceptNode": "quest_active_text",
      "declineNode": "talk_hub"
    },
    "quest_active_text": {
      "type": "TEXT",
      "speaker": "Laura",
      "content": "Find the Shattered Blade. Don't come back empty-handed.",
      "next": "quest_blade_router"
    },
    "quest_blade_router": {
      "type": "ROUTER",
      "condition": "hasItem:shattered_blade",
      "trueNode": "quest_turnin_text",
      "falseNode": "quest_active_choices"
    },
    "quest_active_choices": {
      "type": "CHOICE",
      "options": [
        { "label": "Still looking.", "target": "talk_hub" }
      ]
    },
    "quest_turnin_text": {
      "type": "TEXT",
      "speaker": "Laura",
      "content": "You found it. Hmph. Not bad. The steel is old... very old. Give it here.",
      "next": "quest_turnin_choices"
    },
    "quest_turnin_choices": {
      "type": "CHOICE",
      "options": [
        { "label": "Hand it over.", "target": "action_complete_quest" }
      ]
    },
    "action_complete_quest": {
      "type": "ACTION",
      "action": "COMPLETE_QUEST",
      "questId": "broken_blade",
      "completeNode": "quest_completed_text",
      "takeItem": "shattered_blade"
    },
    "quest_completed_text": {
      "type": "TEXT",
      "speaker": "Laura",
      "content": "I'll need time to work on this. Check back later. And... thanks.",
      "next": "talk_hub"
    }
  }
}
